<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Merit & Bonus Dashboard | Jones Road</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f8f7f5;
            color: #111;
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Password Screen */
        .password-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #f8f7f5;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .password-screen.hidden {
            display: none;
        }

        .password-box {
            background: #fff;
            padding: 48px;
            border-radius: 16px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.08);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .password-box .logo {
            font-size: 24px;
            font-weight: 700;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .password-box .subtitle {
            color: #666;
            font-size: 14px;
            margin-bottom: 32px;
        }

        .password-box label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #666;
            margin-bottom: 8px;
            text-align: left;
        }

        .password-box input {
            width: 100%;
            padding: 14px 16px;
            font-size: 16px;
            font-family: 'DM Sans', sans-serif;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin-bottom: 16px;
            transition: border-color 0.2s;
        }

        .password-box input:focus {
            outline: none;
            border-color: #111;
        }

        .password-box button {
            width: 100%;
            padding: 14px 24px;
            font-size: 13px;
            font-family: 'Space Mono', monospace;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            background: #111;
            color: #fff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .password-box button:hover {
            background: #333;
        }

        .password-error {
            color: #dc2626;
            font-size: 13px;
            margin-top: 12px;
            display: none;
        }

        .password-error.visible {
            display: block;
        }

        .lock-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        /* Main Content - Hidden by default */
        .main-content {
            display: none;
        }

        .main-content.visible {
            display: block;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        header p {
            color: #666;
            font-size: 15px;
        }

        /* Summary Cards */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 16px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            display: flex;
            flex-direction: column;
            min-height: 130px;
        }

        .summary-card.highlight {
            background: #111;
            color: #fff;
        }

        .summary-card h3 {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: #666;
            margin-bottom: 8px;
            min-height: 28px;
        }

        .summary-card.highlight h3 {
            color: #aaa;
        }

        .summary-card .value {
            font-size: 24px;
            font-weight: 700;
            font-family: 'Space Mono', monospace;
            margin-top: auto;
        }

        .summary-card .subvalue {
            font-size: 12px;
            color: #888;
            margin-top: 4px;
        }

        .summary-card.highlight .subvalue {
            color: #aaa;
        }

        @media (max-width: 1200px) {
            .summary-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            .summary-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Filter Section */
        .filters {
            background: #fff;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }

        .filters h2 {
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            margin-bottom: 20px;
        }

        .filter-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: flex-end;
        }

        .filter-group {
            flex: 1;
            min-width: 180px;
        }

        .filter-group label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
            color: #555;
        }

        .filter-group select {
            width: 100%;
            padding: 10px 12px;
            font-size: 14px;
            font-family: 'DM Sans', sans-serif;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #fff;
        }

        .filter-group select:focus {
            outline: none;
            border-color: #111;
        }

        .btn {
            padding: 10px 20px;
            font-size: 12px;
            font-family: 'Space Mono', monospace;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #111;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        /* Charts Section */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 24px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: #fff;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }

        .chart-card h3 {
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            margin-bottom: 20px;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        /* Data Table */
        .table-card {
            background: #fff;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            margin-bottom: 30px;
            overflow: hidden;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .table-header h2 {
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .search-box {
            padding: 10px 14px;
            font-size: 14px;
            border: 1px solid #ddd;
            border-radius: 6px;
            width: 250px;
            font-family: 'DM Sans', sans-serif;
        }

        .search-box:focus {
            outline: none;
            border-color: #111;
        }

        .table-wrapper {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        th, td {
            padding: 12px 10px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #666;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            position: relative;
        }

        th:hover {
            color: #111;
        }

        th.sorted-asc::after {
            content: ' ^';
            font-size: 10px;
        }

        th.sorted-desc::after {
            content: ' v';
            font-size: 10px;
        }

        tr:hover {
            background: #fafafa;
        }

        .money {
            font-family: 'Space Mono', monospace;
            text-align: right;
        }

        .percent {
            font-family: 'Space Mono', monospace;
            text-align: right;
        }

        .positive {
            color: #16a34a;
        }

        .category-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }

        .category-c-suite { background: #fef3c7; color: #92400e; }
        .category-vice-president { background: #fce7f3; color: #9d174d; }
        .category-senior-director { background: #dbeafe; color: #1e40af; }
        .category-director { background: #e0e7ff; color: #3730a3; }
        .category-senior-manager { background: #d1fae5; color: #065f46; }
        .category-manager { background: #cffafe; color: #0e7490; }
        .category-below-manager { background: #f3f4f6; color: #374151; }

        /* Editable input fields in table */
        .editable-input {
            width: 65px;
            padding: 6px 8px;
            font-size: 13px;
            font-family: 'Space Mono', monospace;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: right;
            background: #fff;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .editable-input:focus {
            outline: none;
            border-color: #111;
            box-shadow: 0 0 0 2px rgba(0,0,0,0.1);
        }

        .editable-input:hover {
            border-color: #999;
        }

        .editable-input.changed {
            background: #fef3c7;
            border-color: #f59e0b;
        }

        .editable-input.bonus-input {
            width: 85px;
        }

        .dept-select {
            padding: 5px 8px;
            font-size: 12px;
            font-family: 'DM Sans', sans-serif;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #fff;
            cursor: pointer;
            min-width: 100px;
        }

        .dept-select:focus {
            outline: none;
            border-color: #111;
        }

        .dept-select.changed {
            background: #fef3c7;
            border-color: #f59e0b;
        }

        /* Export buttons */
        .export-section {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-bottom: 20px;
        }

        footer {
            text-align: center;
            padding: 30px;
            color: #888;
            font-size: 13px;
        }

        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }

            .filter-row {
                flex-direction: column;
            }

            .filter-group {
                width: 100%;
            }

            .search-box {
                width: 100%;
            }
        }

        @media print {
            body {
                background: #fff;
            }

            .filters, .view-toggle, .export-section, .search-box, .password-screen {
                display: none !important;
            }

            .main-content {
                display: block !important;
            }

            .table-card, .chart-card, .summary-card {
                box-shadow: none;
                border: 1px solid #eee;
            }
        }
    </style>
</head>
<body>
    <!-- Password Screen -->
    <div class="password-screen" id="passwordScreen">
        <div class="password-box">
            <div class="lock-icon">&#128274;</div>
            <div class="logo">Jones Road</div>
            <div class="subtitle">Staff Merit & Bonus Dashboard</div>
            <form onsubmit="checkPassword(event)">
                <label for="password">Enter Password</label>
                <input type="password" id="password" placeholder="Password" autofocus>
                <button type="submit">Access Dashboard</button>
            </form>
            <div class="password-error" id="passwordError">Incorrect password. Please try again.</div>
        </div>
    </div>

    <!-- Main Content (hidden until password entered) -->
    <div class="main-content" id="mainContent">
        <div class="container">
            <header>
                <div class="logo">Jones Road</div>
                <p>2025 Staff Merit & Bonus Dashboard</p>
            </header>

            <!-- Summary Cards -->
            <div class="summary-grid" id="summaryGrid">
                <!-- Populated by JS -->
            </div>

            <!-- Filters -->
            <div class="filters">
                <h2>Filters</h2>
                <div class="filter-row">
                    <div class="filter-group">
                        <label>Category</label>
                        <select id="filterCategory" onchange="applyFilters()">
                            <option value="">All Categories</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Manager</label>
                        <select id="filterManager" onchange="applyFilters()">
                            <option value="">All Managers</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Department</label>
                        <select id="filterDepartment" onchange="applyFilters()">
                            <option value="">All Departments</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Rating</label>
                        <select id="filterRating" onchange="applyFilters()">
                            <option value="">All Ratings</option>
                        </select>
                    </div>
                    <button class="btn btn-secondary" onclick="resetFilters()">Reset Filters</button>
                </div>
            </div>

            <!-- Charts -->
            <div class="charts-grid">
                <div class="chart-card">
                    <h3>Total Compensation by Category (2026)</h3>
                    <div class="chart-container">
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>Merit Increase % Distribution</h3>
                    <div class="chart-container">
                        <canvas id="meritChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>Headcount by Category</h3>
                    <div class="chart-container">
                        <canvas id="headcountChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>Total Compensation by Department (2026)</h3>
                    <div class="chart-container">
                        <canvas id="teamChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Export Section -->
            <div class="export-section">
                <button class="btn btn-secondary" onclick="resetToOriginal()">Reset to Original</button>
                <button class="btn btn-secondary" onclick="exportCSV()">Export CSV</button>
                <button class="btn btn-secondary" onclick="window.print()">Print / PDF</button>
            </div>

            <!-- Data Table -->
            <div class="table-card">
                <div class="table-header">
                    <h2>Staff Details (<span id="rowCount">0</span> employees)</h2>
                    <input type="text" class="search-box" id="searchBox" placeholder="Search by name, title..." onkeyup="applyFilters()">
                </div>
                <div class="table-wrapper">
                    <table id="staffTable">
                        <thead>
                            <tr>
                                <th onclick="sortTable('name')">Name</th>
                                <th onclick="sortTable('title')">Title</th>
                                <th onclick="sortTable('category')">Category</th>
                                <th onclick="sortTable('currentSalary')" class="money">2025 Salary</th>
                                <th onclick="sortTable('meritPercent')" class="percent">Merit %</th>
                                <th class="money">2026 Salary</th>
                                <th onclick="sortTable('bonusPercent')" class="percent">Bonus %</th>
                                <th class="money">2025 Bonus</th>
                                <th class="money">Total Comp</th>
                                <th onclick="sortTable('department')">Dept</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <footer>
                Jones Road Beauty &middot; Staff Merit Dashboard 2025
            </footer>
        </div>
    </div>

    <script>
        // ========================================
        // PASSWORD PROTECTION
        // ========================================
        // Password hash (SHA-256 of "JonesRoad2025")
        // To change the password, update this hash
        // Generate new hash at: https://emn178.github.io/online-tools/sha256.html
        const PASSWORD_HASH = '9d27aa4a98069d39bd9aa8b051ecf6aa84c85c35ad369418f9534d23eee10449';

        // Check if already authenticated this session
        if (sessionStorage.getItem('jr_authenticated') === 'true') {
            document.getElementById('passwordScreen').classList.add('hidden');
            document.getElementById('mainContent').classList.add('visible');
            initializeDashboard();
        }

        async function hashPassword(password) {
            const encoder = new TextEncoder();
            const data = encoder.encode(password);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        async function checkPassword(event) {
            event.preventDefault();
            const password = document.getElementById('password').value;
            const hash = await hashPassword(password);

            if (hash === PASSWORD_HASH) {
                sessionStorage.setItem('jr_authenticated', 'true');
                document.getElementById('passwordScreen').classList.add('hidden');
                document.getElementById('mainContent').classList.add('visible');
                initializeDashboard();
            } else {
                document.getElementById('passwordError').classList.add('visible');
                document.getElementById('password').value = '';
                document.getElementById('password').focus();
            }
        }

        // ========================================
        // DASHBOARD DATA & LOGIC
        // ========================================
        // Data: currentSalary = 2025 Salary, meritPercent = proposed increase
        // bonusPercent = bonus as % of 2025 salary, department = functional area
        const staffData = [
            { id: 0, name: "Christina DeVries", title: "COO", manager: "Cody", cSuite: "Board", category: "C-Suite", department: "Executive", currentSalary: 300000, meritPercent: 1.0, bonusPercent: 0, rating: null },
            { id: 1, name: "Cody Plofker", title: "CEO", manager: "Board", cSuite: "Board", category: "C-Suite", department: "Executive", currentSalary: 300000, meritPercent: 1.0, bonusPercent: 0, rating: null },
            { id: 2, name: "Aniseh Abukharma", title: "Director of Retail Operations", manager: "Juliet", cSuite: "Cody", category: "Director", department: "Retail", currentSalary: 150000, meritPercent: 3.3, bonusPercent: 18, rating: 3 },
            { id: 3, name: "Erin Silverman", title: "Creative Director", manager: "Cody", cSuite: "Bobbi", category: "Director", department: "Creative", currentSalary: 148000, meritPercent: 8.1, bonusPercent: 20, rating: 3 },
            { id: 4, name: "JT Kim", title: "Director of Logistics & Transportation", manager: "Matt", cSuite: "Chrissy", category: "Director", department: "Operations", currentSalary: 140000, meritPercent: 2.9, bonusPercent: 20, rating: 3 },
            { id: 5, name: "Carly Steakin", title: "Marketing Operations Manager", manager: "Genevieve", cSuite: "Cody", category: "Manager", department: "Marketing", currentSalary: 87000, meritPercent: 3.4, bonusPercent: 15, rating: 3 },
            { id: 6, name: "Cheyenne Pellicoro", title: "Senior Manager Of Makeup Artistry and Education", manager: "Juliet", cSuite: "Bobbi", category: "Senior Manager", department: "Retail", currentSalary: 125000, meritPercent: 13.6, bonusPercent: 15, rating: 3 },
            { id: 7, name: "Shane Duffy", title: "Information Systems Manager", manager: "Chrissy", cSuite: "Chrissy", category: "Manager", department: "IT", currentSalary: 92000, meritPercent: 10.9, bonusPercent: 13, rating: 3 },
            { id: 8, name: "Payal Patel", title: "Senior Director, Brand Marketing", manager: "Cody", cSuite: "Cody", category: "Senior Director", department: "Marketing", currentSalary: 185000, meritPercent: 3.2, bonusPercent: 24, rating: 3 },
            { id: 9, name: "Adrienne Haynes", title: "Product Development Manager", manager: "Nicole", cSuite: "Chrissy", category: "Manager", department: "Product", currentSalary: 90000, meritPercent: 3.3, bonusPercent: 15, rating: 3 },
            { id: 10, name: "Samantha Liegner", title: "Associate Manager Operations", manager: "Matt", cSuite: "Chrissy", category: "Below Manager", department: "Operations", currentSalary: 78000, meritPercent: 10.3, bonusPercent: 10, rating: 3 },
            { id: 11, name: "Natalie Lopez", title: "Senior Director of Demand & Supply Planning", manager: "Chrissy", cSuite: "Chrissy", category: "Senior Director", department: "Operations", currentSalary: 182000, meritPercent: 2.7, bonusPercent: 24, rating: 3 },
            { id: 12, name: "Kaitlyn Colucci", title: "Office Manager/HR Administrator", manager: "Bianca", cSuite: "Chrissy", category: "Below Manager", department: "Finance & HR", currentSalary: 70000, meritPercent: 1.4, bonusPercent: 12, rating: 2 },
            { id: 13, name: "Diana Horan", title: "Senior Graphic Designer", manager: "Erin", cSuite: "Cody", category: "Manager", department: "Creative", currentSalary: 85000, meritPercent: 3.5, bonusPercent: 15, rating: 3 },
            { id: 14, name: "Alyssa Darlington", title: "Community Associate", manager: "Matt", cSuite: "Chrissy", category: "Below Manager", department: "CX", currentSalary: 61000, meritPercent: 1.6, bonusPercent: 10, rating: 2 },
            { id: 15, name: "Genevieve Outwater", title: "Sr. Manager, Marketing Ops", manager: "Payal", cSuite: "Cody", category: "Senior Manager", department: "Marketing", currentSalary: 120000, meritPercent: 8.3, bonusPercent: 15, rating: 3 },
            { id: 16, name: "Nicole Near", title: "Director of Product Development", manager: "Chrissy", cSuite: "Chrissy", category: "Director", department: "Product", currentSalary: 156000, meritPercent: 5.8, bonusPercent: 21, rating: 3 },
            { id: 17, name: "Emma Silverman", title: "Content Producer", manager: "Erin", cSuite: "Cody", category: "Manager", department: "Creative", currentSalary: 80000, meritPercent: 25.0, bonusPercent: 15, rating: 3 },
            { id: 18, name: "Francesca Dygos", title: "Product Development Coordinator", manager: "Nicole", cSuite: "Chrissy", category: "Below Manager", department: "Product", currentSalary: 62000, meritPercent: 3.2, bonusPercent: 10, rating: 3 },
            { id: 19, name: "Dana Valencia", title: "Senior Director of QC and Regulatory Affairs", manager: "Chrissy", cSuite: "Chrissy", category: "Senior Director", department: "QC & Regulatory", currentSalary: 201500, meritPercent: 3.2, bonusPercent: 22, rating: 3 },
            { id: 20, name: "Ersa Qymyri", title: "Manager of Demand & Supply Planning", manager: "Natalie", cSuite: "Chrissy", category: "Manager", department: "Operations", currentSalary: 96000, meritPercent: 3.1, bonusPercent: 15, rating: 3 },
            { id: 21, name: "Kaitlyn Quintavalle", title: "CX Shade Matching Associate", manager: "Matt", cSuite: "Chrissy", category: "Below Manager", department: "CX", currentSalary: 56160, meritPercent: 5.1, bonusPercent: 10, rating: 3 },
            { id: 22, name: "Hyun Kim", title: "Procurement Manager", manager: "Matt", cSuite: "Chrissy", category: "Manager", department: "Operations", currentSalary: 110000, meritPercent: 9.1, bonusPercent: 16, rating: 4 },
            { id: 23, name: "Cecily Lentz", title: "Benefits & Payroll Administrator", manager: "Bianca", cSuite: "C Suite", category: "Manager", department: "Finance & HR", currentSalary: 74200, meritPercent: 2.4, bonusPercent: 15, rating: 3 },
            { id: 24, name: "Joanne Freeman", title: "AP Staff Accountant", manager: "Bianca", cSuite: "C Suite", category: "Below Manager", department: "Finance & HR", currentSalary: 76000, meritPercent: 2.6, bonusPercent: 8, rating: 2 },
            { id: 25, name: "Emily Wouters", title: "CX Makeup Artist", manager: "Matt", cSuite: "Chrissy", category: "Below Manager", department: "CX", currentSalary: 29120, meritPercent: 0.0, bonusPercent: 10, rating: 3 },
            { id: 26, name: "Gianna Glover", title: "Second Assistant to Founder", manager: "Bobbi", cSuite: "Bobbi", category: "Below Manager", department: "Executive", currentSalary: 62000, meritPercent: 12.9, bonusPercent: 10, rating: 4 },
            { id: 27, name: "Courtney Edwards", title: "Executive Assistant to Founder", manager: "Bobbi", cSuite: "Bobbi", category: "Director", department: "Executive", currentSalary: 130000, meritPercent: 2.3, bonusPercent: 20, rating: 2 },
            { id: 28, name: "Matthew Jadro", title: "Sr. Director of Supply Chain & CX", manager: "Chrissy", cSuite: "Chrissy", category: "Senior Director", department: "Operations", currentSalary: 198000, meritPercent: 3.0, bonusPercent: 24, rating: 3 },
            { id: 29, name: "Katie Neglia", title: "Director of Packaging", manager: "Nicole", cSuite: "Chrissy", category: "Director", department: "Product", currentSalary: 150000, meritPercent: 6.7, bonusPercent: 21, rating: 3 },
            { id: 30, name: "Charlotte Newman", title: "Assistant to CMRO & Social Media Coordinator", manager: "Cody", cSuite: "Cody", category: "Manager", department: "Marketing", currentSalary: 78000, meritPercent: 2.6, bonusPercent: 6, rating: 2 },
            { id: 31, name: "Bianca Polycarpe", title: "Chief of Staff", manager: "C Suite", cSuite: "C Suite", category: "Director", department: "Finance & HR", currentSalary: 182000, meritPercent: 2.7, bonusPercent: 20, rating: 3 },
            { id: 32, name: "Samantha Kapalin", title: "CX/Shade Matching Associate", manager: "Matt", cSuite: "Chrissy", category: "Below Manager", department: "CX", currentSalary: 60500, meritPercent: 2.5, bonusPercent: 10, rating: 3 },
            { id: 33, name: "Eliot Malone", title: "Senior Accountant", manager: "Bianca", cSuite: "C Suite", category: "Manager", department: "Finance & HR", currentSalary: 92500, meritPercent: 2.7, bonusPercent: 17, rating: 3 },
            { id: 34, name: "Ben Rosenwald", title: "Sr. Manager, Data", manager: "Bianca", cSuite: "Cody", category: "Senior Manager", department: "Data", currentSalary: 143000, meritPercent: 9.1, bonusPercent: 20, rating: 4 },
            { id: 35, name: "Paul Acquaviva", title: "Supply Chain Coordinator", manager: "Samantha L.", cSuite: "Chrissy", category: "Below Manager", department: "Operations", currentSalary: 60000, meritPercent: 3.3, bonusPercent: 10, rating: 3 },
            { id: 36, name: "Whitney Blau", title: "Director of Retention", manager: "Cody", cSuite: "Cody", category: "Director", department: "Marketing", currentSalary: 170000, meritPercent: 15.3, bonusPercent: 24, rating: 4 },
            { id: 37, name: "Cameron Falco", title: "Video Editor", manager: "Erin", cSuite: "Cody", category: "Below Manager", department: "Creative", currentSalary: 77000, meritPercent: 2.6, bonusPercent: 10, rating: 3 },
            { id: 38, name: "Joseph Dioslaki", title: "Jr. Content Producer & Editor", manager: "Erin", cSuite: "Cody", category: "Below Manager", department: "Creative", currentSalary: 66500, meritPercent: 2.3, bonusPercent: 6, rating: 2 },
            { id: 39, name: "Samantha O'Hara", title: "Sr. Copywriter", manager: "Payal", cSuite: "Cody", category: "Manager", department: "Marketing", currentSalary: 85000, meritPercent: 3.5, bonusPercent: 13, rating: 3 },
            { id: 40, name: "Juliet Baker", title: "VP Of Retail", manager: "Cody", cSuite: "Cody", category: "Vice President", department: "Retail", currentSalary: 250000, meritPercent: 3.2, bonusPercent: 13, rating: 3 },
            { id: 41, name: "Amanda Aldecoa", title: "Regional Director, Retail", manager: "Juliet", cSuite: "Cody", category: "Director", department: "Retail", currentSalary: 160000, meritPercent: 1.9, bonusPercent: 4, rating: 3 },
            { id: 42, name: "Sam Brady", title: "Growth Marketing Manager", manager: "Whitney", cSuite: "Cody", category: "Manager", department: "Marketing", currentSalary: 115000, meritPercent: 12.2, bonusPercent: 4, rating: 3 },
            { id: 43, name: "Ali Wilson", title: "Business Operations Assistant", manager: "Chrissy", cSuite: "Chrissy", category: "Below Manager", department: "Operations", currentSalary: 55000, meritPercent: 1.8, bonusPercent: 3, rating: null }
        ];

        // Helper to calculate proposed salary from current + merit
        function getProposedSalary(s) {
            return Math.round(s.currentSalary * (1 + s.meritPercent / 100));
        }

        // Helper to calculate bonus from 2025 salary * bonus%
        function getBonus(s) {
            return Math.round(s.currentSalary * (s.bonusPercent / 100));
        }

        // Helper to get total comp (2026 salary + 2025 bonus)
        function getTotalComp(s) {
            return getProposedSalary(s) + getBonus(s);
        }

        let filteredData = [...staffData];
        let currentSort = { column: 'name', direction: 'asc' };
        let charts = {};

        function initializeDashboard() {
            loadSavedChanges(); // Load any saved modifications first
            populateFilters();
            updateSummary();
            renderTable();
            initCharts();
        }

        function populateFilters() {
            const categories = [...new Set(staffData.map(s => s.category))].sort();
            const categorySelect = document.getElementById('filterCategory');
            categories.forEach(c => {
                categorySelect.innerHTML += `<option value="${c}">${c}</option>`;
            });

            const managers = [...new Set(staffData.map(s => s.manager))].sort();
            const managerSelect = document.getElementById('filterManager');
            managers.forEach(m => {
                managerSelect.innerHTML += `<option value="${m}">${m}</option>`;
            });

            const departments = [...new Set(staffData.map(s => s.department))].sort();
            const deptSelect = document.getElementById('filterDepartment');
            departments.forEach(d => {
                deptSelect.innerHTML += `<option value="${d}">${d}</option>`;
            });

            const ratings = [...new Set(staffData.map(s => s.rating).filter(r => r !== null))].sort();
            const ratingSelect = document.getElementById('filterRating');
            ratings.forEach(r => {
                ratingSelect.innerHTML += `<option value="${r}">${r}</option>`;
            });
        }

        function applyFilters() {
            const categoryFilter = document.getElementById('filterCategory').value;
            const managerFilter = document.getElementById('filterManager').value;
            const deptFilter = document.getElementById('filterDepartment').value;
            const ratingFilter = document.getElementById('filterRating').value;
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();

            filteredData = staffData.filter(s => {
                if (categoryFilter && s.category !== categoryFilter) return false;
                if (managerFilter && s.manager !== managerFilter) return false;
                if (deptFilter && s.department !== deptFilter) return false;
                if (ratingFilter && s.rating !== parseInt(ratingFilter)) return false;
                if (searchTerm) {
                    const searchable = `${s.name} ${s.title} ${s.manager}`.toLowerCase();
                    if (!searchable.includes(searchTerm)) return false;
                }
                return true;
            });

            updateSummary();
            renderTable();
            updateCharts();
        }

        function resetFilters() {
            document.getElementById('filterCategory').value = '';
            document.getElementById('filterManager').value = '';
            document.getElementById('filterDepartment').value = '';
            document.getElementById('filterRating').value = '';
            document.getElementById('searchBox').value = '';
            filteredData = [...staffData];
            updateSummary();
            renderTable();
            updateCharts();
        }

        function formatMoney(num) {
            return '$' + num.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
        }

        function updateSummary() {
            const totalHeadcount = filteredData.length;
            const totalCurrentSalary = filteredData.reduce((sum, s) => sum + s.currentSalary, 0);
            const totalProposedSalary = filteredData.reduce((sum, s) => sum + getProposedSalary(s), 0);
            const totalBonus = filteredData.reduce((sum, s) => sum + getBonus(s), 0);
            const totalComp = filteredData.reduce((sum, s) => sum + getTotalComp(s), 0);
            const avgMerit = filteredData.length > 0 ? (filteredData.reduce((sum, s) => sum + s.meritPercent, 0) / filteredData.length) : 0;
            const avgBonus = filteredData.length > 0 ? (filteredData.reduce((sum, s) => sum + s.bonusPercent, 0) / filteredData.length) : 0;
            const meritIncrease = totalProposedSalary - totalCurrentSalary;

            document.getElementById('summaryGrid').innerHTML = `
                <div class="summary-card">
                    <h3>Headcount</h3>
                    <div class="value">${totalHeadcount}</div>
                    <div class="subvalue">Full-time employees</div>
                </div>
                <div class="summary-card">
                    <h3>2025 Salary</h3>
                    <div class="value">${formatMoney(totalCurrentSalary)}</div>
                    <div class="subvalue">Current base</div>
                </div>
                <div class="summary-card">
                    <h3>2026 Salary</h3>
                    <div class="value">${formatMoney(totalProposedSalary)}</div>
                    <div class="subvalue positive">+${formatMoney(meritIncrease)}</div>
                </div>
                <div class="summary-card">
                    <h3>Avg Merit</h3>
                    <div class="value">${avgMerit.toFixed(1)}%</div>
                    <div class="subvalue">Increase</div>
                </div>
                <div class="summary-card">
                    <h3>2025 Bonus</h3>
                    <div class="value">${formatMoney(totalBonus)}</div>
                    <div class="subvalue">Avg ${avgBonus.toFixed(0)}%</div>
                </div>
                <div class="summary-card highlight">
                    <h3>Total Comp 2026</h3>
                    <div class="value">${formatMoney(totalComp)}</div>
                    <div class="subvalue">Salary + Bonus</div>
                </div>
            `;
        }

        function getCategoryClass(category) {
            const classes = {
                'C-Suite': 'category-c-suite',
                'Vice President': 'category-vice-president',
                'Senior Director': 'category-senior-director',
                'Director': 'category-director',
                'Senior Manager': 'category-senior-manager',
                'Manager': 'category-manager',
                'Below Manager': 'category-below-manager'
            };
            return classes[category] || 'category-below-manager';
        }

        function sortTable(column) {
            if (currentSort.column === column) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.column = column;
                currentSort.direction = 'asc';
            }

            filteredData.sort((a, b) => {
                let valA = a[column];
                let valB = b[column];

                if (typeof valA === 'string') {
                    valA = valA.toLowerCase();
                    valB = valB.toLowerCase();
                }

                if (valA < valB) return currentSort.direction === 'asc' ? -1 : 1;
                if (valA > valB) return currentSort.direction === 'asc' ? 1 : -1;
                return 0;
            });

            renderTable();
        }

        function renderTable() {
            const tbody = document.getElementById('tableBody');
            document.getElementById('rowCount').textContent = filteredData.length;

            document.querySelectorAll('th').forEach(th => {
                th.classList.remove('sorted-asc', 'sorted-desc');
            });

            const allDepts = ['Marketing', 'Operations', 'Creative', 'Product', 'CX', 'Finance & HR', 'Retail', 'Executive', 'QC & Regulatory', 'Data', 'IT'];

            tbody.innerHTML = filteredData.map(s => `
                <tr>
                    <td><strong>${s.name}</strong></td>
                    <td>${s.title}</td>
                    <td><span class="category-badge ${getCategoryClass(s.category)}">${s.category}</span></td>
                    <td class="money">${formatMoney(s.currentSalary)}</td>
                    <td class="percent">
                        <input type="number" class="editable-input"
                               value="${s.meritPercent.toFixed(1)}"
                               step="0.1" min="0" max="100"
                               data-id="${s.id}" data-field="meritPercent"
                               onchange="updateEmployee(this)">
                    </td>
                    <td class="money">${formatMoney(getProposedSalary(s))}</td>
                    <td class="percent">
                        <input type="number" class="editable-input"
                               value="${s.bonusPercent}"
                               step="1" min="0" max="100"
                               data-id="${s.id}" data-field="bonusPercent"
                               onchange="updateEmployee(this)">
                    </td>
                    <td class="money">${formatMoney(getBonus(s))}</td>
                    <td class="money"><strong>${formatMoney(getTotalComp(s))}</strong></td>
                    <td>
                        <select class="dept-select" data-id="${s.id}" data-field="department" onchange="updateEmployee(this)">
                            ${allDepts.map(d => `<option value="${d}" ${s.department === d ? 'selected' : ''}>${d}</option>`).join('')}
                        </select>
                    </td>
                </tr>
            `).join('');
        }

        function updateEmployee(input) {
            const id = parseInt(input.dataset.id);
            const field = input.dataset.field;
            const value = field === 'department' ? input.value : (parseFloat(input.value) || 0);

            // Find the employee in staffData and update
            const employee = staffData.find(s => s.id === id);
            if (employee) {
                employee[field] = value;
                input.classList.add('changed');

                // Update filtered data reference
                filteredData = filteredData.map(s => s.id === id ? employee : s);

                // Update the row's calculated cells (only for numeric fields)
                if (field !== 'department') {
                    const row = input.closest('tr');
                    const cells = row.querySelectorAll('td');
                    cells[5].textContent = formatMoney(getProposedSalary(employee)); // 2026 Salary
                    cells[7].textContent = formatMoney(getBonus(employee)); // 2025 Bonus $
                    cells[8].innerHTML = '<strong>' + formatMoney(getTotalComp(employee)) + '</strong>'; // Total Comp
                }

                // Recalculate summaries and charts
                updateSummary();
                updateCharts();

                // Save to localStorage
                saveChanges();
            }
        }

        // Save modified data to localStorage
        function saveChanges() {
            const modifications = {};
            staffData.forEach(s => {
                modifications[s.id] = { meritPercent: s.meritPercent, bonusPercent: s.bonusPercent, department: s.department };
            });
            localStorage.setItem('jr_merit_modifications', JSON.stringify(modifications));
        }

        // Load saved modifications from localStorage
        function loadSavedChanges() {
            const saved = localStorage.getItem('jr_merit_modifications');
            if (saved) {
                const modifications = JSON.parse(saved);
                staffData.forEach(s => {
                    if (modifications[s.id]) {
                        if (modifications[s.id].meritPercent !== undefined) {
                            s.meritPercent = modifications[s.id].meritPercent;
                        }
                        if (modifications[s.id].bonusPercent !== undefined) {
                            s.bonusPercent = modifications[s.id].bonusPercent;
                        }
                        if (modifications[s.id].department !== undefined) {
                            s.department = modifications[s.id].department;
                        }
                    }
                });
                filteredData = [...staffData];
            }
        }

        // Reset to original values (clear localStorage and reload)
        function resetToOriginal() {
            if (confirm('Reset all merit % and bonus % values to original? This cannot be undone.')) {
                localStorage.removeItem('jr_merit_modifications');
                location.reload();
            }
        }

        function initCharts() {
            const chartColors = {
                'C-Suite': '#fbbf24',
                'Vice President': '#ec4899',
                'Senior Director': '#3b82f6',
                'Director': '#6366f1',
                'Senior Manager': '#10b981',
                'Manager': '#06b6d4',
                'Below Manager': '#6b7280'
            };

            const categoryData = getDataByCategory();
            charts.category = new Chart(document.getElementById('categoryChart'), {
                type: 'bar',
                data: {
                    labels: Object.keys(categoryData),
                    datasets: [{
                        label: 'Total Compensation',
                        data: Object.values(categoryData).map(d => d.totalComp),
                        backgroundColor: Object.keys(categoryData).map(c => chartColors[c] || '#6b7280')
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { callback: value => '$' + (value / 1000) + 'K' }
                        }
                    }
                }
            });

            const meritRanges = getMeritDistribution();
            charts.merit = new Chart(document.getElementById('meritChart'), {
                type: 'bar',
                data: {
                    labels: Object.keys(meritRanges),
                    datasets: [{
                        label: 'Employees',
                        data: Object.values(meritRanges),
                        backgroundColor: '#111'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }
                }
            });

            charts.headcount = new Chart(document.getElementById('headcountChart'), {
                type: 'doughnut',
                data: {
                    labels: Object.keys(categoryData),
                    datasets: [{
                        data: Object.values(categoryData).map(d => d.count),
                        backgroundColor: Object.keys(categoryData).map(c => chartColors[c] || '#6b7280')
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'right' } }
                }
            });

            const deptColors = {
                'Marketing': '#3b82f6',
                'Operations': '#10b981',
                'Creative': '#ec4899',
                'Product': '#8b5cf6',
                'Finance & HR': '#f59e0b',
                'CX': '#06b6d4',
                'Retail': '#ef4444',
                'Executive': '#fbbf24',
                'QC & Regulatory': '#84cc16',
                'Data': '#6366f1',
                'IT': '#64748b'
            };

            const deptData = getDataByDepartment();
            charts.dept = new Chart(document.getElementById('teamChart'), {
                type: 'bar',
                data: {
                    labels: Object.keys(deptData),
                    datasets: [{
                        label: 'Total Compensation',
                        data: Object.values(deptData).map(d => d.totalComp),
                        backgroundColor: Object.keys(deptData).map(d => deptColors[d] || '#6b7280')
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { callback: value => '$' + (value / 1000) + 'K' }
                        }
                    }
                }
            });
        }

        function getDataByCategory() {
            const data = {};
            filteredData.forEach(s => {
                if (!data[s.category]) {
                    data[s.category] = { count: 0, totalComp: 0, totalBonus: 0 };
                }
                data[s.category].count++;
                data[s.category].totalComp += getTotalComp(s);
                data[s.category].totalBonus += s.bonusPercent;
            });

            Object.keys(data).forEach(k => {
                data[k].avgBonus = data[k].count > 0 ? data[k].totalBonus / data[k].count : 0;
            });

            return data;
        }

        function getDataByDepartment() {
            const data = {};
            filteredData.forEach(s => {
                const dept = s.department;
                if (!data[dept]) {
                    data[dept] = { count: 0, totalComp: 0, totalSalary: 0 };
                }
                data[dept].count++;
                data[dept].totalComp += getTotalComp(s);
                data[dept].totalSalary += getProposedSalary(s);
            });
            return data;
        }

        function getMeritDistribution() {
            const ranges = { '0%': 0, '1-5%': 0, '5-10%': 0, '10-15%': 0, '15-20%': 0, '20%+': 0 };

            filteredData.forEach(s => {
                if (s.meritPercent === 0) ranges['0%']++;
                else if (s.meritPercent <= 5) ranges['1-5%']++;
                else if (s.meritPercent <= 10) ranges['5-10%']++;
                else if (s.meritPercent <= 15) ranges['10-15%']++;
                else if (s.meritPercent <= 20) ranges['15-20%']++;
                else ranges['20%+']++;
            });

            return ranges;
        }

        function updateCharts() {
            const categoryData = getDataByCategory();
            const meritRanges = getMeritDistribution();
            const deptData = getDataByDepartment();

            charts.category.data.labels = Object.keys(categoryData);
            charts.category.data.datasets[0].data = Object.values(categoryData).map(d => d.totalComp);
            charts.category.update();

            charts.merit.data.datasets[0].data = Object.values(meritRanges);
            charts.merit.update();

            charts.headcount.data.labels = Object.keys(categoryData);
            charts.headcount.data.datasets[0].data = Object.values(categoryData).map(d => d.count);
            charts.headcount.update();

            charts.dept.data.labels = Object.keys(deptData);
            charts.dept.data.datasets[0].data = Object.values(deptData).map(d => d.totalComp);
            charts.dept.update();
        }

        function exportCSV() {
            const headers = ['Name', 'Title', 'Department', 'Category', '2025 Salary', 'Merit %', '2026 Salary', 'Bonus %', '2025 Bonus', 'Total Comp 2026'];
            const rows = filteredData.map(s => [
                s.name, s.title, s.department, s.category, s.currentSalary,
                s.meritPercent, getProposedSalary(s), s.bonusPercent, getBonus(s), getTotalComp(s)
            ]);

            const csv = [headers, ...rows].map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'staff-merit-2025.csv';
            a.click();
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
